<?xml version="1.0"?>

<launch>

  <!-- CONFIG -->
  <!-- enable_encode = {true, false} -->
  <arg name="enable_encode" default="false"/>
  <!-- run_rviz = {true, false} -->
  <arg name="run_rviz" default="true"/>
  <!-- File to record last robot pose -->
  <arg name="pose_file_name" value="$(find chickenbot)/config/amcl_pose.yaml"/>

  <!-- TF -->
  <node pkg="tf" type="static_transform_publisher" name="tf_laser_broadcaster" args="0 0 0 0 0 0 base_link laser 50"/>

  <!-- MAP SERVER -->
  <node name="map_server" pkg="map_server" type="map_server" args="$(find chickenbot)/map/chicken.yaml">
    <!--remap from="map" to="global_map"/-->
  </node>


  <!-- MY_ODOM is a node who can publish tf(/base_link) and nav_msgs/Odometry(/odom) according to wheel encoders -->
  <node pkg="my_odom" type="my_odom_sim" name="my_odom" output="screen">
    <param name="cnt_per_cycle" value="75000" />
    <param name="wheel_radius" value="0.08" />
    <param name="wheel_distance" value="0.502" />
    <param name="enable_encode" value="$(arg enable_encode)" />
    <param name="enable_amcl" value="$(arg enable_amcl)" />
    <param name="pose_file_param" value="$(arg pose_file_name)"/>
  </node>

  <arg name="costmap_common_params_file" value="$(find chickenbot)/config/costmap_common_params.yaml"/>
  <arg name="local_costmap_params_file"  value="$(find chickenbot)/config/local_costmap_params.yaml"/>
  <arg name="base_global_planner" value="navfn/NavfnROS"/>
  <arg name="global_costmap_params_file" value="$(find chickenbot)/config/global_costmap_params.yaml"/>
  <arg name="dwa_planner_params_file" default="$(find chickenbot)/config/dwa_planner_params.yaml"/>


  <node pkg="move_base" type="move_base" respawn="false" name="move_base" output="screen">
    <param name="controller_frequency" value="1.0"/>
    <param name="controller_patiente" value="10.0"/>
    <rosparam file="$(arg costmap_common_params_file)" command="load" ns="global_costmap" />
    <rosparam file="$(arg costmap_common_params_file)" command="load" ns="local_costmap" />
    <rosparam file="$(arg global_costmap_params_file)"  command="load" />
    <rosparam file="$(arg local_costmap_params_file)" command="load" />
    <rosparam file="$(arg dwa_planner_params_file)"   command="load" />
    <param name="base_global_planner"       value="$(arg base_global_planner)"/>
    <param name="base_local_planner"        value="dwa_local_planner/DWAPlannerROS"/>
  </node>


  <!-- RVIZ -->
  <node pkg="rviz" type="rviz" name="rviz" output="screen" if="$(arg run_rviz)" />

</launch>
